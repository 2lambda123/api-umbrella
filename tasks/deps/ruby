#!/usr/bin/env bash

ruby_version="2.4.7"
ruby_hash="c10d6ba6c890aacdf27b733e96ec3859c3ff33bfebb9b6dc8e96879636be7bf5"

set -e -u -x
source ./tasks/helpers.sh

task_working_dir
download "https://cache.ruby-lang.org/pub/ruby/2.4/ruby-$ruby_version.tar.bz2" "sha256" "$ruby_hash"
extract_download "ruby-$ruby_version.tar.bz2"

cd "ruby-$ruby_version"
./configure \
  --prefix="$INSTALL_PREFIX_EMBEDDED" \
  --enable-load-relative \
  --disable-rpath \
  --disable-install-doc
make -j"$NPROC"
make install DESTDIR="$STAGE_DIR"

stamp
