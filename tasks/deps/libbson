#!/usr/bin/env bash

libbson_version="1.16.2"
libbson_hash="6561011b25d0e690d0759247bcd390e4"

set -e -u -x
source ./tasks/helpers.sh

task_working_dir
download "https://github.com/mongodb/mongo-c-driver/releases/download/$libbson_version/mongo-c-driver-$libbson_version.tar.gz" "md5" "$libbson_hash"
extract_download "mongo-c-driver-$libbson_version.tar.gz"

cd "mongo-c-driver-$libbson_version"
mkdir cmake-build
cd cmake-build
cmake -DENABLE_AUTOMATIC_INIT_AND_CLEANUP=OFF -DENABLE_MONGOC=OFF -DCMAKE_INSTALL_PREFIX="$INSTALL_PREFIX_EMBEDDED" ..
make -j"$NPROC"
DESTDIR="$STAGE_DIR" make install

stamp
