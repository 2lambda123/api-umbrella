#!/usr/bin/env bash

libbson_version="1.21.1"
libbson_hash="b16003f876b5d962ffa78c1ad7b805f5"

set -e -u -x
source ./tasks/helpers.sh

task_working_dir
download "https://github.com/mongodb/mongo-c-driver/releases/download/$libbson_version/mongo-c-driver-$libbson_version.tar.gz" "md5" "$libbson_hash"
extract_download "mongo-c-driver-$libbson_version.tar.gz"

cd "mongo-c-driver-$libbson_version"
mkdir cmake-build
cd cmake-build
cmake -DENABLE_AUTOMATIC_INIT_AND_CLEANUP=OFF -DENABLE_MONGOC=OFF -DCMAKE_INSTALL_PREFIX="$INSTALL_PREFIX_EMBEDDED" ..
make -j"$NPROC"
DESTDIR="$STAGE_DIR" make install

stamp
