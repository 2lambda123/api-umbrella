#!/usr/bin/env bash

libmongoc_version="1.13.1"
libmongoc_hash="f927308f9ede1d1de0c41a7a5f807bc6"

set -e -u -x
source ./tasks/helpers.sh

task_working_dir
download "https://github.com/mongodb/mongo-c-driver/releases/download/$libmongoc_version/mongo-c-driver-$libmongoc_version.tar.gz" "md5" "$libmongoc_hash"
extract_download "mongo-c-driver-$libmongoc_version.tar.gz"

cd "mongo-c-driver-$libmongoc_version"
mkdir cmake-build
cd cmake-build
cmake -DENABLE_AUTOMATIC_INIT_AND_CLEANUP=OFF -DCMAKE_INSTALL_PREFIX="$INSTALL_PREFIX_EMBEDDED" ..
make -j"$NPROC"
DESTDIR="$STAGE_DIR" make install
find "$STAGE_EMBEDDED_DIR/bin/" -name "mongoc*" -exec chrpath -d {} \;

stamp
