#!/usr/bin/env bash

elasticsearch6_version="6.8.18"
elasticsearch6_hash="11981c316b65e7d407b85dffd70506a5f08b472b064f8f382d9a864f220b63792bf8f23b5e2485627f49f21d2ee5a966542e8c955acc4b3ac37094750e7c409c"

set -e -u -x
source ./tasks/helpers.sh

task_working_dir
download "https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-oss-$elasticsearch6_version.tar.gz" "sha512" "$elasticsearch6_hash"
extract_download "elasticsearch-oss-$elasticsearch6_version.tar.gz"

mkdir -p "$TEST_INSTALL_PREFIX/elasticsearch6"
rsync -a -v --checksum \
  --delete-after \
  --delete-excluded \
  --exclude "modules/ingest-geoip*" \
  "elasticsearch-$elasticsearch6_version/" \
  "$TEST_INSTALL_PREFIX/elasticsearch6/"
# Fix jdk directories being chmod 750.
find "$TEST_INSTALL_PREFIX/elasticsearch6/" -type d -print0 | xargs -0 chmod 755
chmod -R o+r "$TEST_INSTALL_PREFIX/elasticsearch6/config"
"$TEST_INSTALL_PREFIX/elasticsearch6/bin/elasticsearch-keystore" create
chmod 660 "$TEST_INSTALL_PREFIX/elasticsearch6/config/elasticsearch.keystore"

stamp
