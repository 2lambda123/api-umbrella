#!/usr/bin/env bash

set -e -u -x

source_dir="$(dirname "$(dirname "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)")")"

# shellcheck source=build/package_dependencies.sh
source "$source_dir/build/package_dependencies.sh"

install_dependencies=("${all_build_dependencies[@]}")
if [ "${INSTALL_TEST_DEPENDENCIES:-}" == "true" ]; then
  install_dependencies=("${all_dependencies[@]}")
fi

if [ -f /etc/redhat-release ]; then
  yum -y install "${install_dependencies[@]}"
  # Ensure the packages got installed, since yum's exit code isn't always
  # useful: http://stackoverflow.com/a/22393088
  rpm --query --queryformat "" "${install_dependencies[@]}"
elif [ -f /etc/debian_version ]; then
  apt-get update
  apt-get -y install "${install_dependencies[@]}"
else
  echo "Unknown build system"
  exit 1
fi
