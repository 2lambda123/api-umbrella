<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Installation - Documentation - API Umbrella</title>
    <link href="../../stylesheets/all-30ecdeba.css" rel="stylesheet" type="text/css" />
    <script src="../../javascripts/all-08595316.js" type="text/javascript"></script>
    <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Raleway:400,300,700" rel="stylesheet" type="text/css">

    <link rel="canonical" href="http://apiumbrella.io/docs/install/" />
    <script>
      if(window.location.href.indexOf('nrel.github.io') !== -1) {
        window.location.href = 'http://apiumbrella.io/docs/install/';
      }
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42866857-2', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
  <body class="docs docs_install docs_install_index">
    <div id="navigation" class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#"><i class="fa fa-umbrella"></i> <b>API Umbrella</b></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class=""><a href="../../">Home</a></li>
            <li class=""><a href="../../download/">Download</a></li>
            <li class="active"><a href="./">Documentation</a></li>
          </ul>
        </div>
      </div>
    </div>

      <header>
        <div class="container">
          <h1>Documentation</h1>
        </div>
      </header>

      <div class="container">
    <div class="row">
      <nav class="col-md-3">
        <div class="nav-section">User Guide</div>
<ul>
   <li class="">
    <a href="../api-keys/">API Keys</a>
  </li>
</ul>

<hr>

<div class="nav-section">Administrator Guide</div>
<ul>
  <li class="active">
    <a href="./">Installation</a>
  </li>
  <li class="">
    <a href="../getting-started/">Getting Started</a>
  </li>
  <li class="">
    <a href="../architecture/">Architecture</a>
  </li>
  <li class="">
    <a href="../admin-api/">Administrative REST API</a>
  </li>
  <li class="">
    <a href="../backend-headers/">Backend HTTP Headers</a>
  </li>
  <li class="">
    <a href="../caching/">Caching</a>
  </li>
  <li class="">
    <a href="../smtp-configuration/">SMTP Configuration</a>
  </li>
</ul>

<hr>

<div class="nav-section">Developer Guide</div>
<ul>
  <li class="">
    <a href="../development-setup/">Development Setup</a>
  </li>
  <li class="">
    <a href="../deployment/">Deploying From Git</a>
  </li>
</ul>

      </nav>
      <div class="col-md-9">
        <h2 id="installation">Installation</h2>

<ul>
  <li><a href="#basic-install">Basic Install</a></li>
  <li><a href="#https-configuration">HTTPS Configuration</a></li>
  <li><a href="#multi-server-install">Multi-Server Install</a></li>
</ul>

<h3 id="basic-install">Basic Install</h3>

<ul>
  <li><a href="../../download/">Download</a> and install the package for your platform.</li>
  <li>
    <p>Open the configuration file for editing:</p>

<pre class="highlight shell"><code><span class="gp">$ </span>sudo -e /etc/api-umbrella/api-umbrella.yml
</code></pre>
  </li>
  <li>
    <p>In the config file, define an e-mail address for your first admin account:</p>

<pre class="highlight yaml"><code><span class="s">web</span><span class="pi">:</span>
  <span class="s">admin</span><span class="pi">:</span>
    <span class="s">initial_superusers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">your.email@example.com</span>
</code></pre>
  </li>
  <li>
    <p>Start API Umbrella:</p>

<pre class="highlight shell"><code><span class="gp">$ </span>sudo /etc/init.d/api-umbrella start
</code></pre>
  </li>
  <li>
    <p>Browse to your server's hostname. You should land on the default homepage:</p>

    <p><img alt="Default API Umbrella homepage" class="img-responsive img-center" src="../../images/default_homepage-89697e75.png" /></p>

    <p>Congrats! You're now up and running with API Umbrella. There are a variety of things you can do to start using the platform. For a quick tutorial, see <a href="../getting-started/">getting started</a></p>
  </li>
</ul>

<h3 id="https-configuration">HTTPS Configuration</h3>

<p>By default, API Umbrella requires HTTPS for a variety of endpoints. On initial installation, API Umbrella will use as self-signed certificate which won't be valid for production use. For production, you have two primary options:</p>

<ul>
  <li><strong>SSL Termination:</strong> If you're placing API Umbrella behind a load balancer in a multi-server setup, you can handle the SSL termination with that external load balancer.</li>
  <li>
    <p><strong>SSL Certificate Installation:</strong> You can configure API Umbrella with a valid SSL certificate, rather than the self-signed default one. To do so, install the certificates on your server, and then adjust the <code>/etc/api-umbrella/api-umbrella.yml</code> to point to these certificate files for your domain:</p>

<pre class="highlight yaml"><code><span class="s">hosts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">hostname</span><span class="pi">:</span> <span class="s">api.example.com</span>
    <span class="s">default</span><span class="pi">:</span> <span class="s">true</span>
    <span class="s">ssl_cert</span><span class="pi">:</span> <span class="s">/etc/ssl/your_cert.crt</span>
    <span class="s">ssl_cert_key</span><span class="pi">:</span> <span class="s">/etc/ssl/your_cert.key</span>
</code></pre>

    <p><code>ssl_cert</code> should point to a valid certificate file in the format supported by nginx's <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_certificate"><code>ssl_certificate</code></a>.</p>

    <p><code>ssl_cert_key</code> should point to a valid private key file in the format supported by nginx's <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_certificate_key"><code>ssl_certificate_key</code></a>.</p>
  </li>
</ul>

<h3 id="multi-server-install">Multi-Server Install</h3>

<p>A <a href="#basic-install">basic install</a> will result in all of the API Umbrella services running on a single server. You may wish to scale your installation to multiple servers for redundancy or performance reasons.</p>

<h4 id="services">Services</h4>

<p>The first thing to understand with a multi-server installation are the individual services that can be run on each server. By default, all required services are run, but you can explicitly configure which services get run if you wish to split things off to different servers (for example, separating your database servers from your proxy servers).</p>

<p>To define which services get run, define the <code>services</code> configuration inside your <code>/etc/api-umbrella/api-umbrella.yml</code> configuration file:</p>

<pre class="highlight yaml"><code><span class="s">services</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">general_db</span>
  <span class="pi">-</span> <span class="s">log_db</span>
  <span class="pi">-</span> <span class="s">router</span>
  <span class="pi">-</span> <span class="s">web</span>
</code></pre>

<p>This configuration enables all the available services. To disable a service, remove its line from the configuration.</p>

<p>The services available are:</p>

<ul>
  <li><code>general_db</code>: The MongoDB database used for configuration, user information, and other miscellaneous data.</li>
  <li><code>log_db</code>: The ElasticSearch database used for logging and analytics.</li>
  <li><code>router</code>: The core reverse proxy and routing capabilities of API Umbrella.</li>
  <li><code>web</code>: The web application providing API Umbrella's administration app and REST APIs.</li>
</ul>

<h4 id="suggested-server-setups">Suggested Server Setups</h4>

<p>In general, you'll need at least 3 servers in a multi-server setup since the database servers need an odd number of members for failover and voting purposes (see <a href="http://docs.mongodb.org/manual/core/replica-set-architectures/#deploy-an-odd-number-of-members">MongoDB Replica Set Strategies</a>). Here are some possible server setups:</p>

<ul>
  <li>3 servers with all services running on all servers:
    <ul>
      <li>3 servers with <code>router</code>, <code>web</code>, <code>general_db</code>, and <code>log_db</code> services enabled.</li>
    </ul>
  </li>
  <li>5 servers with the databases running on separate servers:
    <ul>
      <li>2 servers with <code>router</code> and <code>web</code> services enabled.</li>
      <li>3 servers with <code>general_db</code> and <code>log_db</code> services enabled.</li>
    </ul>
  </li>
  <li>4 servers with the databases running on separate servers, and a MongoDB arbiter running on one of the proxy servers for voting purposes:
    <ul>
      <li>1 server with <code>router</code> and <code>web</code> services enabled.</li>
      <li>1 server with <code>router</code>, <code>web</code>, <code>general_db</code> services enabled (but with MongoDB configured to be an arbiter for voting purposes only).</li>
      <li>2 servers with <code>general_db</code> and <code>log_db</code> services enabled.</li>
    </ul>
  </li>
</ul>

<h4 id="load-balancing">Load Balancing</h4>

<p>If you have multiple proxy or web servers running, you'll need to load balance between these multiple API Umbrella servers from an external load balancer. For a highly available setup, using something like an AWS ELB (or your hosting provider's equivalent) is probably the easiest approach. Alternatives involve setting up your own load balancer (nginx, HAProxy, etc).</p>

<h4 id="database-configuration">Database Configuration</h4>

<p>If you have multiple database servers, you'll need to adjust the <code>/etc/api-umbrella/api-umbrella.yml</code> configuration on all the servers to define the addresses of each database servers.</p>

<p>For the ElasticSearch servers (any server with the <code>log_db</code> role), define the server IPs:</p>

<pre class="highlight yaml"><code><span class="s">elasticsearch</span><span class="pi">:</span>
  <span class="s">hosts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">http://10.0.0.1:14002</span>
    <span class="pi">-</span> <span class="s">http://10.0.0.2:14002</span>
    <span class="pi">-</span> <span class="s">http://10.0.0.3:14002</span>
</code></pre>

<p>For the MongoDB servers (any server with the <code>general_db</code> role), define the server IPs and replicaset name:</p>

<pre class="highlight yaml"><code><span class="s">mongodb</span><span class="pi">:</span>
  <span class="s">url</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mongodb://10.0.0.1:14001,10.0.0.2:14001,10.0.0.3:14001/api_umbrella"</span>
  <span class="s">embedded_server_config</span><span class="pi">:</span>
    <span class="s">replication</span><span class="pi">:</span>
      <span class="s">replSetName</span><span class="pi">:</span> <span class="s">api-umbrella</span>
</code></pre>

      </div>
    </div>
  </div>


    <div style="text-align: center; font-style: italic; padding: 2em 0.5em;">
      <a href="https://github.com/NREL/api-umbrella/blob/master/website/docs/install.md.erb">Help Improve this Content</a>
    </div>
  </body>
</html>
