  # Continuing the `api_router` shared frontend configuration.
  #
  # This configuration file will be joined together so it belongs to the
  # `api_router` frontend as part of HAProxy's restart process (by the
  # haproxy_join script).

  # Match the hostname (this allows for subdomains in our sandboxes).
  acl host_match-<%= deploy_name %> hdr_beg(host) -i <%= domain %>

  # Main Site Services: Sort of a special case. This isn't one of our normal
  # API backends, but instead our documentation and account signup application.
  # However, this application also exposes a small bit of account signup
  # functionality as a service, so accounts can be created remotely.
  acl url_match_api_public_site-<%= deploy_name %> path_beg -i -f <%= File.join(latest_release, "config", "haproxy", "api_router_matches", "api_public_site.lst") %>
  use_backend public_site_farm-<%= deploy_name %> if host_match-<%= deploy_name %> url_match_api_public_site-<%= deploy_name %>

  # Sustainable Fuels & Vehicles Services
  acl url_match_api_sfv-<%= deploy_name %> path_beg -i -f <%= File.join(latest_release, "config", "haproxy", "api_router_matches", "api_sfv.lst") %>
  use_backend api_sfv_farm-<%= deploy_name %> if host_match-<%= deploy_name %> url_match_api_sfv-<%= deploy_name %>

  # georeserv Services
  acl url_match_api_georeserv-<%= deploy_name %> path_beg -i -f <%= File.join(latest_release, "config", "haproxy", "api_router_matches", "api_georeserv.lst") %>
  use_backend api_georeserv_farm-<%= deploy_name %> if host_match-<%= deploy_name %> url_match_api_georeserv-<%= deploy_name %>
