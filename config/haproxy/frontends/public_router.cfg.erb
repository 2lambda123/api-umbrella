frontend public_router <%= domain %>:80
  option forwardfor

  <% if(stage == :development) %>
  # Special devdev.nrel.gov virtual hosts
  acl host_match_docs hdr_beg(host) -i docs.devdev.nrel.gov
  use_backend devdev_doc_farm if host_match_docs
  <% end %>

  # Requests starting with /api get sent to the auth proxy for authentication
  # and rate limiting.
  acl url_match_api path_beg /api/
  use_backend auth_proxy_farm if url_match_api

  # All other requests go to our main site.
  default_backend public_site_farm
