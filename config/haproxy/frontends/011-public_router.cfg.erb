  # Continuing the `public_router` shared frontend configuration.
  #
  # This configuration file will be joined together so it belongs to the
  # `public_router` frontend as part of HAProxy's restart process (by the
  # haproxy_join script).
 
  # Match the hostname (this allows for subdomains in our sandboxes).
  acl host_match-<%= deploy_name %> hdr_beg(host) -i <%= domain %>

  # Requests starting with /api get sent to the auth proxy for authentication
  # and rate limiting.
  acl url_match_api-<%= deploy_name %> path_beg /api/
  use_backend auth_proxy_farm-<%= deploy_name %> if host_match-<%= deploy_name %> url_match_api-<%= deploy_name %>

  # All other requests go to our main site.
  use_backend public_site_farm-<%= deploy_name %> if host_match-<%= deploy_name %>
